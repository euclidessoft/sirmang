{% extends 'layout4.html.twig' %}
{% block title %} TAM- Assemblee Generale  {% endblock %}
{% block caisse %} class="active" {% endblock %}
{% block cotisation %} class="active" {% endblock %}

{% block body %}
<h3><i class="fa fa-suitcase"></i> Caisse / <i class="fa fa-legal"></i> Conseil d'Administration / Cotisations</h3>
<div class="row">
    <div class="col-md-12">
    <div class="panel panel-primary">
        
        
        <!-- /.panel-heading -->
        <div class="panel-body">
            
            <div class="row">
                <div class="col-2">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <div style="position: fixed;"> 
                    <a {% if mois.id == 1 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-home-tab"  href="{{ path('cotisation_ca', {  mois : 1 })}}" role="tab" aria-controls="v-pills-home">Janvier</a>
                    <a {% if mois.id == 2 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-profile-tab"  href="{{ path('cotisation_ca', {  mois : 2 })}}" role="tab" aria-controls="v-pills-profile">Fevrier</a>
                    <a {% if mois.id == 3 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-messages-tab" href="{{ path('cotisation_ca', {  mois : 3 })}}" role="tab" aria-controls="v-pills-messages">Mars</a>
                    <a {% if mois.id == 4 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-settings-tab" href="{{ path('cotisation_ca', {  mois : 4 })}}" role="tab" aria-controls="v-pills-settings">Avril</a>
                    <a {% if mois.id == 5 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-home-tab" href="{{ path('cotisation_ca', {  mois : 5 })}}" role="tab" aria-controls="v-pills-home">Mai</a>
                    <a {% if mois.id == 6 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-profile-tab" href="{{ path('cotisation_ca', {  mois : 6 })}}" role="tab" aria-controls="v-pills-profile">Juin</a>
                    <a {% if mois.id == 7 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-messages-tab" href="{{ path('cotisation_ca', {  mois : 7 })}}" role="tab" aria-controls="v-pills-messages">Juillet</a>
                    <a {% if mois.id == 8 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-settings-tab" href="{{ path('cotisation_ca', {  mois : 8 })}}" role="tab" aria-controls="v-pills-settings">Aout</a>
                    <a {% if mois.id == 9 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-home-tab" href="{{ path('cotisation_ca', {  mois : 9 })}}" role="tab" aria-controls="v-pills-home">Septembre</a>
                    <a {% if mois.id == 10 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-profile-tab" href="{{ path('cotisation_ca', {  mois : 10 })}}" role="tab" aria-controls="v-pills-profile">Octobre</a>
                    <a {% if mois.id == 11 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-messages-tab" href="{{ path('cotisation_ca', {  mois : 11 })}}" role="tab" aria-controls="v-pills-messages">Novembre</a>
                    <a {% if mois.id == 12 %} class="nav-link active" data-toggle="pill"  aria-selected="true"{% else %} class="nav-link"  aria-selected="false"{% endif %} id="v-pills-settings-tab" href="{{ path('cotisation_ca', {  mois : 12 })}}" role="tab" aria-controls="v-pills-settings">Decembre</a>
                  </div>
                  </div>
                </div>
                <div class="col-10">
                  <div class="tab-content" id="v-pills-tabContent">
                    <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                        <h3 class="text-center">2022</h3>
                        {% for message in app.flashes('notice')%}
    <div class="alert alert-success alert-dismissible fade show radius-10 shadow-black">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        {{ message|trans }}
    </div>
    {% endfor%}
    <div class="alert alert-primary">
        {{ users|length }} élément(s) trouvé(s)
    </div>
    <div class="row">
        <div class="col-12 mb-4">
    {% if is_granted('ROLE_MODIF_FIN_BEN') %}
        <button class="btn btn-normal btn-success mb-4" onclick="cotiser({{ mois.id }})">
            <i class="fa fa-money"></i>
            <i class="fa fa-long-arrow-right"></i>
            <i class="fa fa-suitcase"></i>
            {{ 'Cotiser'|trans }}
        </button>
    {% endif %}
    <button type="button" data-toggle="modal" href="#nombre" id="subm" class="btn btn-normal btn-primary pull-right">
        <i class="fa fa-list"></i>
        {{ 'Déjà cotiser'|trans }}
    </button>
    </div>
    </div>
    <div class="modal" id="nombre" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg mt-5" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title text-center" id="packtitle">
                        {{ 'Liste des membres'|trans }}
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-primary">
                        {{ cotisusers|length }} élément(s) trouvé(s)
                    </div>
                    <table width="100%" class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                
                                <th class="text-center">
                                    {{ 'Photo'|trans }}
                                </th>
                                <th>
                                    {{ 'Identifiant'|trans }}
                                </th>
                                <th>
                                    {{ 'Nom et Prénom'|trans }}
                                </th>
                                <th>
                                    {{ 'Téléphone'|trans }}
                                </th>
                                <th class="text-center">
                                    {{ 'Montant'|trans }}
                                </th>
                                <th class="text-center">
                                    {{ 'annuler'|trans }}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in cotisusers %}
                            <tr>
                                
                                <td data-label="{{ 'Photo'|trans }}">
                                    <b><a href="{{ path('finance_user', { user : user.id })}}">
                                        {% if user.user.sexe == "Monsieur" %}
                                        <img src="{{asset('images/avatar.jpg') }}" width="50" alt="Photo" class="rounded-circle" />
                                        {% else %}
                                        <img src="{{asset('images/avatar-femme.jpg') }}" width="50" alt="Photo" class="rounded-circle" />
                                        {% endif %}
                                    </a></b>
                                </td>
                                <td data-label="{{ 'Identifiant'|trans }}">
                                   <b> <a href="{{ path('finance_user', { user : user.id })}}">
                                        {{ user.user.username|upper }}
                                    </a></b>
                                </td>
                                <td data-label="{{ 'Prénom'|trans }}">
                                   <b> <a href="{{ path('finance_user', { user : user.id })}}">
                                        {{ user.user.nom|upper }} {{ user.user.prenom }} 
                                    </a></b>
                                </td>
                                <td data-label="{{ 'Prénom'|trans }}">
                                    <b> <a href="{{ path('finance_user', { user : user.id })}}">
                                         {{ user.user.phone }}
                                     </a></b>
                                 </td>
                                <td data-label="{{ 'Montant'|trans }}" class="text-center">
                                   <b> <a href="{{ path('finance_user', { user : user.id })}}">
                                        {{ user.user.cotisation }}
                
                                    </a></b>
                                </td>
                                <td data-label="{{ 'Annuler'|trans }}" class="text-center">
                                    {{ include('cotisation/_delete_form.html.twig') }}    
                                 </td>
                               </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    
                    
                </div>
            </div>
        </div>
    </div>
    
    <table width="100%" class="table table-striped table-bordered table-hover" id="liste">
        <thead>
            <tr>
                <th>
                    <input type="checkbox" id="tous" onchange="selectAll()" />
                </th>
                <th class="text-center">
                    {{ 'Photo'|trans }}
                </th>
                <th>
                    {{ 'Identifiant'|trans }}
                </th>
                <th>
                    {{ 'Nom et Prénom'|trans }}
                </th>
                <th class="text-center">
                    {{ 'Montant'|trans }}
                </th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr id="tr{{user.id}}">
                <td data-label="{{ 'Choisir'|trans }}">
                    <input type="checkbox" id="{{ user.id}}" onchange="trselect({{user.id}})" class="checkbox-center" />
                </td>
                <td data-label="{{ 'Photo'|trans }}">
                    <b><a href="{{ path('finance_user', { user : user.id })}}">
                        {% if user.sexe == "Monsieur" %}
                        <img src="{{asset('images/avatar.jpg') }}" width="50" alt="Photo" class="rounded-circle" />
                        {% else %}
                        <img src="{{asset('images/avatar-femme.jpg') }}" width="50" alt="Photo" class="rounded-circle" />
                        {% endif %}
                    </a></b>
                </td>
                <td data-label="{{ 'Identifiant'|trans }}">
                   <b> <a href="{{ path('finance_user', { user : user.id })}}">
                        {{ user.username|upper }}
                    </a></b>
                </td>
                <td data-label="{{ 'Prénom'|trans }}">
                   <b> <a href="{{ path('finance_user', { user : user.id })}}">
                        {{ user.nom|upper }} {{ user.prenom }} 
                    </a></b>
                </td>
                <td data-label="{{ 'Montant'|trans }}" class="text-center">
                   <b> <a href="{{ path('finance_user', { user : user.id })}}">
                        {{ user.cotisation|number_format(0, '', ' ') }}

                    </a></b>
                </td>
               
            {% endfor %}
        </tbody>
    </table>
    <div class="row">
        <div class="col-12" id="exportexcel">

        </div>
    </div>
</div>
</div>



</div>
</div>

                    </div>
                    <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">...</div>
                    <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">...</div>
                    <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">...</div>
                  </div>
                </div>
              </div>
    
{% block scripts %}
<script>
   function cotiser(mois) {
        var mbr = "0";
        $("input[type=checkbox]:checked").each(
            function() {
                if ($(this).attr("id") != 'tous') mbr = mbr + ";" + $(this).attr("id");
            });
        if (mbr != "0") {
            if (confirm('Confirmer!!!')) {
                $('button').html("<div class=\"spinner-border spinner-border-sm text-light\" role=\"status\"><span class=\"sr-only\">Loading...</span></div>");
                $.ajax({
                    type: "POST",
                    url: "{{ path('bureau_multiple_index')}}",
                    data: "mbr=" + mbr + "&mois=" + mois,
                    success: function(data) {
                        if (data['id'] != '') {
                            document.location.href = "/Finance/Cotisation/CA/"+ mois+ "/";
                        }
                    },
                    error: function() {
                        alert('La requête n\'a pas abouti');
                    }
                });
            }
        } else alert('Selectionnez un membre au moins');
    }

    function trselect(id) { 
        if ($("#" + id).is(':checked')) {
            $("#tr" + id).css('background', 'rgba(18, 95, 139, 0.5)');
        } else {
            $("#tr" + id).css('background', '');
        }
    }
   
    function selectAll() { 
        if ($("#tous").is(':checked')) {
            $("input[type=checkbox]").each(
                function() {
                    if ($(this).attr("id") != 'nav-toggle'){
                        if ($(this).is(':checked')) {

                        } else {
                            $(this).trigger('click')
                        }
                        trselect($(this).attr("id"));
                    }
                });
        } else {
            $("input[type=checkbox]").each(
                function() {
                    if ($(this).attr("id") != 'nav-toggle'){
                        if ($(this).is(':checked')) {
                            $(this).trigger('click')
                        }
                        trselect($(this).attr("id"));
                     }
                });
        }
    }

</script>
{% endblock %}
{% endblock %}
